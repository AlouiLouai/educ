# EduDocs Market | Gemini Spec

## 1. Context & Tech Stack
- **Framework:** Next.js 15 (App Router, React 18).
- **Backend:** Supabase (Auth, PostgreSQL, RLS).
- **Styling:** Tailwind CSS + Shadcn UI.
- **State:** URL-driven state for filtering; Server-first data fetching.

## 2. Database & Auth (CRITICAL)
- **SQL Executed:** `supabase_setup.sql` has been executed in Supabase.
  - Table `public.profiles` is synced with `auth.users` via a **PostgreSQL Trigger**.
  - Fields: `id`, `first_name`, `last_name`, `email`, `role`, `avatar_url`.
- **Auth Flow:** Google OAuth + PKCE.
  - User role (`student` | `teacher`) is captured in metadata during sign-up.
  - Callback: `src/app/auth/callback/route.ts` handles session and role persistence.

## 3. Security Architecture
- **Defense in Depth:** 
  1. `middleware.ts` handles coarse route protection.
  2. Protected `layout.tsx` files perform secondary `getUser()` server-side checks.
- **Role Enforcement:** Strict whitelisting in the auth callback.

## 4. Coding Standards
- **Server Components:** Prefer Server Components for data fetching.
- **Types:** Centralized in `src/types/index.ts`.
- **Mock Data:** Isolated in `src/lib/data/mock.ts`.
- **DRY:** Use `cn()` for Tailwind class merging; keep logic in `src/lib`.

## 5. Directory Map
- `src/app/(role)`: Protected route groups.
- `src/lib/supabase`: Server and Browser clients (using `process.env`).
- `src/components/ui`: Atomic Shadcn components.
- `src/components/auth`: Multi-role auth modal logic.

---
*Generated by Gemini CLI - Spec-Driven Development Mode*
